<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Faustino Oro - Partidas de Ajedrez</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: center;
        }

        h1 {
            color: #333;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            font-size: 1.2em;
            margin-bottom: 20px;
        }

        .stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            color: #999;
            font-size: 0.9em;
            margin-top: 5px;
        }

        .filters {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filters label {
            font-weight: bold;
            color: #333;
        }

        .filters select {
            padding: 10px;
            border: 2px solid #667eea;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
        }

        .loading {
            text-align: center;
            color: white;
            font-size: 1.5em;
            padding: 50px;
        }

        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .game-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .game-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .tournament-badge {
            background: #ff9800;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
            margin-bottom: 10px;
            display: inline-block;
        }

        .tournament-badge.otb {
            background: #e91e63;
        }

        .tournament-badge.online {
            background: #2196f3;
        }

        .tournament-badge.chesscom {
            background: #81b64c;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .game-result {
            font-size: 1.8em;
            font-weight: bold;
            padding: 5px 15px;
            border-radius: 8px;
        }

        .result-win {
            background: #4caf50;
            color: white;
        }

        .result-loss {
            background: #f44336;
            color: white;
        }

        .result-draw {
            background: #ff9800;
            color: white;
        }

        .game-date {
            color: #999;
            font-size: 0.9em;
        }

        .tournament-name {
            color: #e91e63;
            font-weight: bold;
            font-size: 0.95em;
            margin-bottom: 10px;
        }

        .players {
            margin-bottom: 15px;
        }

        .player {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            margin: 5px 0;
            border-radius: 6px;
        }

        .player-white {
            background: #f5f5f5;
        }

        .player-black {
            background: #333;
            color: white;
        }

        .player-name {
            font-weight: bold;
            flex: 1;
        }

        .player-rating {
            background: #667eea;
            color: white;
            padding: 3px 10px;
            border-radius: 5px;
            font-size: 0.9em;
        }

        .game-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid #f0f0f0;
        }

        .info-item {
            font-size: 0.9em;
        }

        .info-label {
            color: #999;
            display: block;
            margin-bottom: 3px;
        }

        .info-value {
            color: #333;
            font-weight: bold;
        }

        .link-button {
            display: inline-block;
            margin-top: 10px;
            padding: 8px 15px;
            background: #667eea;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            font-size: 0.9em;
            transition: background 0.3s;
        }

        .link-button:hover {
            background: #5568d3;
        }

        .error {
            background: white;
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            color: #f44336;
            font-size: 1.2em;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.8em;
            }
            
            .games-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üèÜ Faustino Oro</h1>
            <div class="subtitle">Maestro Internacional - Prodigio del Ajedrez Argentino</div>
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-value" id="totalGames">-</div>
                    <div class="stat-label">Partidas Totales</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="wins">-</div>
                    <div class="stat-label">Victorias</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="draws">-</div>
                    <div class="stat-label">Empates</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="losses">-</div>
                    <div class="stat-label">Derrotas</div>
                </div>
            </div>
        </header>

        <div class="filters">
            <label>üóìÔ∏è Mes:</label>
            <select id="monthSelect">
                <option value="">Cargando...</option>
            </select>
            
            <label>‚ôüÔ∏è Tipo:</label>
            <select id="typeSelect">
                <option value="all">Todas</option>
                <option value="otb">Torneos Presenciales</option>
                <option value="online">Partidas Online</option>
            </select>

            <label>‚è±Ô∏è Modalidad:</label>
            <select id="speedSelect">
                <option value="all">Todas</option>
                <option value="rapid">R√°pidas</option>
                <option value="blitz">Blitz</option>
                <option value="bullet">Bullet</option>
                <option value="classical">Cl√°sicas</option>
            </select>

            <label>üåê Fuente:</label>
            <select id="sourceSelect">
                <option value="all">Todas</option>
                <option value="chesscom">Chess.com</option>
                <option value="lichess">Lichess</option>
                <option value="broadcasts">Torneos FIDE</option>
            </select>
        </div>

        <div id="loading" class="loading" style="display:none;">
            Cargando partidas de Faustino Oro...
        </div>

        <div id="gamesContainer" class="games-grid"></div>
        <div id="error"></div>
    </div>

    <script>
        const CHESSCOM_USERNAME = 'FaustinoOro';
        const LICHESS_USERNAME = 'FaustiOro';
        const FIDE_ID = '20000197';
        
        let allGames = [];
        let broadcastGames = [];

        // Generate month options
        function generateMonthOptions() {
            const select = document.getElementById('monthSelect');
            select.innerHTML = '<option value="all">Todos los meses</option>';
            
            const now = new Date();
            for (let i = 0; i < 24; i++) {
                const date = new Date(now.getFullYear(), now.getMonth() - i, 1);
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const monthName = date.toLocaleDateString('es', { month: 'long', year: 'numeric' });
                
                const option = document.createElement('option');
                option.value = `${year}/${month}`;
                option.textContent = monthName.charAt(0).toUpperCase() + monthName.slice(1);
                select.appendChild(option);
            }

            select.value = 'all';
        }

        // Fetch Chess.com games
        async function fetchChesscomGames(year, month) {
            try {
                const url = `https://api.chess.com/pub/player/${CHESSCOM_USERNAME}/games/${year}/${month}`;
                const response = await fetch(url);
                if (!response.ok) return [];
                const data = await response.json();
                return (data.games || []).map(g => ({
                    ...g, 
                    source: 'chesscom',
                    isOTB: false,
                    timestamp: g.end_time
                }));
            } catch (error) {
                console.error('Error fetching Chess.com games:', error);
                return [];
            }
        }

        // Fetch Lichess games
        async function fetchLichessGames(year, month) {
            try {
                const startDate = new Date(year, month - 1, 1);
                const endDate = new Date(year, month, 0, 23, 59, 59);
                const since = startDate.getTime();
                const until = endDate.getTime();
                
                const url = `https://lichess.org/api/games/user/${LICHESS_USERNAME}?since=${since}&until=${until}&max=100&pgnInJson=false`;
                const response = await fetch(url, {
                    headers: { 'Accept': 'application/x-ndjson' }
                });
                
                if (!response.ok) return [];
                
                const text = await response.text();
                const games = text.trim().split('\n')
                    .filter(line => line)
                    .map(line => {
                        try {
                            return JSON.parse(line);
                        } catch {
                            return null;
                        }
                    })
                    .filter(g => g);
                
                return games.map(g => ({
                    ...g, 
                    source: 'lichess',
                    isOTB: false,
                    timestamp: Math.floor(g.createdAt / 1000)
                }));
            } catch (error) {
                console.error('Error fetching Lichess games:', error);
                return [];
            }
        }

        // Fetch Lichess broadcasts (OTB tournaments)
        async function fetchLichessBroadcasts() {
            try {
                // Known broadcast IDs for major tournaments featuring Faustino
                const broadcastIds = [
                    'pYWxUzLr', // FIDE World Cup 2025
                ];

                let allBroadcastGames = [];

                for (const broadcastId of broadcastIds) {
                    try {
                        const url = `https://lichess.org/api/broadcast/${broadcastId}`;
                        const response = await fetch(url);
                        if (!response.ok) continue;
                        
                        const broadcast = await response.json();
                        
                        // Fetch games from all rounds
                        if (broadcast.tour && broadcast.tour.rounds) {
                            for (const round of broadcast.tour.rounds) {
                                try {
                                    const roundUrl = `https://lichess.org/api/broadcast/round/${round.id}`;
                                    const roundResponse = await fetch(roundUrl);
                                    if (!roundResponse.ok) continue;
                                    
                                    const roundData = await roundResponse.json();
                                    
                                    if (roundData.games) {
                                        const faustinoGames = roundData.games.filter(game => {
                                            const white = (game.players && game.players[0] && game.players[0].name) || '';
                                            const black = (game.players && game.players[1] && game.players[1].name) || '';
                                            return white.includes('Oro') || white.includes('Faustino') ||
                                                   black.includes('Oro') || black.includes('Faustino');
                                        });

                                        faustinoGames.forEach(game => {
                                            allBroadcastGames.push({
                                                source: 'broadcast',
                                                isOTB: true,
                                                tournament: broadcast.tour.name,
                                                round: round.name,
                                                game: game,
                                                timestamp: Math.floor(new Date(round.startsAt || Date.now()).getTime() / 1000),
                                                url: `https://lichess.org/broadcast/-/-/${round.id}`
                                            });
                                        });
                                    }
                                } catch (e) {
                                    console.error('Error fetching round:', e);
                                }
                            }
                        }
                    } catch (e) {
                        console.error('Error fetching broadcast:', e);
                    }
                }

                return allBroadcastGames;
            } catch (error) {
                console.error('Error fetching Lichess broadcasts:', error);
                return [];
            }
        }

        // Load all games
        async function loadAllGames() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('gamesContainer').innerHTML = '';
            document.getElementById('error').innerHTML = '';

            const monthSelect = document.getElementById('monthSelect');
            const selectedMonth = monthSelect.value;

            allGames = [];

            // Fetch broadcast games
            broadcastGames = await fetchLichessBroadcasts();

            if (selectedMonth === 'all') {
                // Load last 6 months from both platforms
                const now = new Date();
                for (let i = 0; i < 6; i++) {
                    const date = new Date(now.getFullYear(), now.getMonth() - i, 1);
                    const year = date.getFullYear();
                    const month = String(date.getMonth() + 1).padStart(2, '0');
                    
                    const chesscomGames = await fetchChesscomGames(year, month);
                    const lichessGames = await fetchLichessGames(year, month);
                    
                    allGames = allGames.concat(chesscomGames, lichessGames);
                }
            } else {
                const [year, month] = selectedMonth.split('/');
                const chesscomGames = await fetchChesscomGames(year, month);
                const lichessGames = await fetchLichessGames(year, month);
                allGames = allGames.concat(chesscomGames, lichessGames);
            }

            // Add broadcast games
            allGames = allGames.concat(broadcastGames);

            // Sort by date (newest first)
            allGames.sort((a, b) => b.timestamp - a.timestamp);

            document.getElementById('loading').style.display = 'none';

            if (allGames.length === 0) {
                document.getElementById('error').innerHTML = '<div class="error">No se encontraron partidas</div>';
                updateStats([]);
                return;
            }

            filterAndDisplayGames();
        }

        // Filter and display games
        function filterAndDisplayGames() {
            const typeSelect = document.getElementById('typeSelect').value;
            const speedSelect = document.getElementById('speedSelect').value;
            const sourceSelect = document.getElementById('sourceSelect').value;

            let filteredGames = allGames;

            // Filter by type (OTB vs Online)
            if (typeSelect === 'otb') {
                filteredGames = filteredGames.filter(g => g.isOTB);
            } else if (typeSelect === 'online') {
                filteredGames = filteredGames.filter(g => !g.isOTB);
            }

            // Filter by speed
            if (speedSelect !== 'all') {
                filteredGames = filteredGames.filter(game => {
                    if (game.source === 'chesscom') {
                        return game.time_class === speedSelect;
                    } else if (game.source === 'lichess') {
                        return game.speed === speedSelect;
                    } else if (game.source === 'broadcast') {
                        return speedSelect === 'classical';
                    }
                    return false;
                });
            }

            // Filter by source
            if (sourceSelect !== 'all') {
                if (sourceSelect === 'broadcasts') {
                    filteredGames = filteredGames.filter(g => g.source === 'broadcast');
                } else {
                    filteredGames = filteredGames.filter(g => g.source === sourceSelect);
                }
            }

            updateStats(filteredGames);
            displayGames(filteredGames);
        }

        // Update statistics
        function updateStats(games) {
            let wins = 0, draws = 0, losses = 0;

            games.forEach(game => {
                const result = getGameResult(game);
                if (result === 'Victoria') wins++;
                else if (result === 'Empate') draws++;
                else if (result === 'Derrota') losses++;
            });

            document.getElementById('totalGames').textContent = games.length;
            document.getElementById('wins').textContent = wins;
            document.getElementById('draws').textContent = draws;
            document.getElementById('losses').textContent = losses;
        }

        // Get game result
        function getGameResult(game) {
            if (game.source === 'chesscom') {
                const white = game.white.username.toLowerCase();
                const isFaustinoWhite = white === CHESSCOM_USERNAME.toLowerCase();
                
                if (game.white.result === 'win') return isFaustinoWhite ? 'Victoria' : 'Derrota';
                if (game.black.result === 'win') return isFaustinoWhite ? 'Derrota' : 'Victoria';
                if (['agreed', 'repetition', 'stalemate', 'insufficient', 'draw'].includes(game.white.result) || 
                    game.black.result === 'draw') return 'Empate';
                return 'Derrota';
            } else if (game.source === 'lichess') {
                const white = (game.players.white.user?.name || '').toLowerCase();
                const black = (game.players.black.user?.name || '').toLowerCase();
                const isFaustinoWhite = white === LICHESS_USERNAME.toLowerCase();
                const isFaustinoBlack = black === LICHESS_USERNAME.toLowerCase();
                
                if (['draw', 'stalemate'].includes(game.status)) return 'Empate';
                if (game.winner === 'white') return isFaustinoWhite ? 'Victoria' : 'Derrota';
                if (game.winner === 'black') return isFaustinoBlack ? 'Victoria' : 'Derrota';
                return 'Empate';
            } else if (game.source === 'broadcast') {
                // Parse PGN result
                const pgn = game.game.pgn || '';
                const resultMatch = pgn.match(/\[Result "(.+?)"\]/);
                if (!resultMatch) return 'Empate';
                
                const result = resultMatch[1];
                const whiteName = (game.game.players && game.game.players[0] && game.game.players[0].name) || '';
                const isFaustinoWhite = whiteName.includes('Oro') || whiteName.includes('Faustino');
                
                if (result === '1-0') return isFaustinoWhite ? 'Victoria' : 'Derrota';
                if (result === '0-1') return isFaustinoWhite ? 'Derrota' : 'Victoria';
                return 'Empate';
            }
            return 'Empate';
        }

        // Display games
        function displayGames(games) {
            const container = document.getElementById('gamesContainer');
            container.innerHTML = '';

            if (games.length === 0) {
                container.innerHTML = '<div class="error">No hay partidas que coincidan con los filtros</div>';
                return;
            }

            games.forEach(game => {
                const card = createGameCard(game);
                if (card) container.appendChild(card);
            });
        }

        // Create game card
        function createGameCard(game) {
            if (game.source === 'chesscom') {
                return createChesscomCard(game);
            } else if (game.source === 'lichess') {
                return createLichessCard(game);
            } else if (game.source === 'broadcast') {
                return createBroadcastCard(game);
            }
            return null;
        }

        // Create Chess.com card
        function createChesscomCard(game) {
            const card = document.createElement('div');
            card.className = 'game-card';

            const white = game.white;
            const black = game.black;
            const isFaustinoWhite = white.username.toLowerCase() === CHESSCOM_USERNAME.toLowerCase();
            const result = getGameResult(game);
            const resultClass = result === 'Victoria' ? 'result-win' : result === 'Empate' ? 'result-draw' : 'result-loss';

            const date = new Date(game.end_time * 1000).toLocaleDateString('es', {
                day: 'numeric',
                month: 'long',
                year: 'numeric'
            });

            const timeControl = game.time_control || 'N/A';
            const timeClass = game.time_class ? game.time_class.charAt(0).toUpperCase() + game.time_class.slice(1) : 'N/A';

            card.innerHTML = `
                <span class="tournament-badge chesscom">Chess.com Online</span>
                <div class="game-header">
                    <div class="game-result ${resultClass}">${result}</div>
                    <div class="game-date">${date}</div>
                </div>
                
                <div class="players">
                    <div class="player player-white">
                        <span class="player-name">‚ö™ ${white.username}${isFaustinoWhite ? ' üë§' : ''}</span>
                        <span class="player-rating">${white.rating}</span>
                    </div>
                    <div class="player player-black">
                        <span class="player-name">‚ö´ ${black.username}${!isFaustinoWhite ? ' üë§' : ''}</span>
                        <span class="player-rating">${black.rating}</span>
                    </div>
                </div>

                <div class="game-info">
                    <div class="info-item">
                        <span class="info-label">Modalidad</span>
                        <span class="info-value">${timeClass}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Control</span>
                        <span class="info-value">${timeControl}</span>
                    </div>
                </div>

                <a href="${game.url}" target="_blank" class="link-button">Ver partida ‚Üí</a>
            `;

            return card;
        }

        // Create Lichess card
        function createLichessCard(game) {
            const card = document.createElement('div');
            card.className = 'game-card';

            const white = game.players.white;
            const black = game.players.black;
            const whiteName = white.user?.name || 'An√≥nimo';
            const blackName = black.user?.name || 'An√≥nimo';
            const isFaustinoWhite = whiteName.toLowerCase() === LICHESS_USERNAME.toLowerCase();
            const result = getGameResult(game);
            const resultClass = result === 'Victoria' ? 'result-win' : result === 'Empate' ? 'result-draw' : 'result-loss';

            const date = new Date(game.createdAt).toLocaleDateString('es', {
                day: 'numeric',
                month: 'long',
                year: 'numeric'
            });

            const speed = game.speed ? game.speed.charAt(0).toUpperCase() + game.speed.slice(1) : 'N/A';
            const clock = game.clock ? `${Math.floor(game.clock.initial / 60)}+${game.clock.increment}` : 'N/A';

            card.innerHTML = `
                <span class="tournament-badge online">Lichess Online</span>
                <div class="game-header">
                    <div class="game-result ${resultClass}">${result}</div>
                    <div class="game-date">${date}</div>
                </div>
                
                <div class="players">
                    <div class="player player-white">
                        <span class="player-name">‚ö™ ${whiteName}${isFaustinoWhite ? ' üë§' : ''}</span>
                        <span class="player-rating">${white.rating || 'N/A'}</span>
                    </div>
                    <div class="player player-black">
                        <span class="player-name">‚ö´ ${blackName}${!isFaustinoWhite ? ' üë§' : ''}</span>
                        <span class="player-rating">${black.rating || 'N/A'}</span>
                    </div>
                </div>

                <div class="game-info">
                    <div class="info-item">
                        <span class="info-label">Modalidad</span>
                        <span class="info-value">${speed}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Control</span>
                        <span class="info-value">${clock}</span>
                    </div>
                </div>

                <a href="https://lichess.org/${game.id}" target="_blank" class="link-button">Ver partida ‚Üí</a>
            `;

            return card;
        }

        // Create broadcast card (OTB tournaments)
        function createBroadcastCard(game) {
            const card = document.createElement('div');
            card.className = 'game-card';

            const players = game.game.players || [];
            const whiteName = (players[0] && players[0].name) || 'Desconocido';
            const blackName = (players[1] && players[1].name) || 'Desconocido';
            const whiteRating = (players[0] && players[0].rating) || 'N/A';
            const blackRating = (players[1] && players[1].rating) || 'N/A';
            
            const isFaustinoWhite = whiteName.includes('Oro') || whiteName.includes('Faustino');
            const result = getGameResult(game);
            const resultClass = result === 'Victoria' ? 'result-win' : result === 'Empate' ? 'result-draw' : 'result-loss';

            const date = new Date(game.timestamp * 1000).toLocaleDateString('es', {
                day: 'numeric',
                month: 'long',
                year: 'numeric'
            });

            card.innerHTML = `
                <span class="tournament-badge otb">Torneo Presencial OTB</span>
                <div class="tournament-name">üèÜ ${game.tournament} - ${game.round}</div>
                <div class="game-header">
                    <div class="game-result ${resultClass}">${result}</div>
                    <div class="game-date">${date}</div>
                </div>
                
                <div class="players">
                    <div class="player player-white">
                        <span class="player-name">‚ö™ ${whiteName}${isFaustinoWhite ? ' üë§' : ''}</span>
                        <span class="player-rating">${whiteRating}</span>
                    </div>
                    <div class="player player-black">
                        <span class="player-name">‚ö´ ${blackName}${!isFaustinoWhite ? ' üë§' : ''}</span>
                        <span class="player-rating">${blackRating}</span>
                    </div>
                </div>

                <div class="game-info">
                    <div class="info-item">
                        <span class="info-label">Modalidad</span>
                        <span class="info-value">Cl√°sica</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Tipo</span>
                        <span class="info-value">OTB</span>
                    </div>
                </div>

                <a href="${game.url}" target="_blank" class="link-button">Ver partida ‚Üí</a>
            `;

            return card;
        }

        // Initialize
        generateMonthOptions();
        loadAllGames();

        // Event listeners
        document.getElementById('monthSelect').addEventListener('change', loadAllGames);
        document.getElementById('typeSelect').addEventListener('change', filterAndDisplayGames);
        document.getElementById('speedSelect').addEventListener('change', filterAndDisplayGames);
        document.getElementById('sourceSelect').addEventListener('change', filterAndDisplayGames);
    </script>
</body>
</html>